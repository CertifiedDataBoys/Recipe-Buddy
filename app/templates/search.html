{{ render_partial('partials/header.html') }}
<div class="sidebar">
    <div class="sideBarCategory">
        <p>Filter by Type</p>
    </div>
    <span class="sideBarButton" id="sideBarRecipeTypeFilter-1" onclick="toggleTypeFilter($('#sideBarRecipeTypeFilter-1'));">Sandwich</span>
    <span class="sideBarButton" id="sideBarRecipeTypeFilter-2" onclick="toggleTypeFilter($('#sideBarRecipeTypeFilter-2'));">Pasta</span>
    <span class="sideBarButton" id="sideBarRecipeTypeFilter-3" onclick="toggleTypeFilter($('#sideBarRecipeTypeFilter-3'));">Drink</span>
    <span class="sideBarButton" id="sideBarRecipeTypeFilter-4" onclick="toggleTypeFilter($('#sideBarRecipeTypeFilter-4'));">Seafood</span>
    <span class="sideBarButton" id="sideBarRecipeTypeFilter-5" onclick="toggleTypeFilter($('#sideBarRecipeTypeFilter-5'));">Vegan</span>
    <!-- <a class="sideBarButton" id="typeBtnMore" href="#">More...</a> -->
    <div class="sidebarBreakLine"></div>
    <div class="sideBarCategory">
        <p>Filter by Kitchenware</p>
    </div>
    <div id="kitchenwareContainer">
    </div>
    <div class="sidebarBreakLine"></div>
</div>
<div id="main">
    <div class="container">
        <strong>Recipes</strong><br>Search: <span id="search-term"></span>
        <div id="search-limit"></div>
        <div id="search-results"></div>
    </div>
</div>
<script>
    var getUrlParameter = function getUrlParameter(sParam) {
        var sPageURL = window.location.search.substring(1),
            sURLVariables = sPageURL.split('&'),
            sParameterName,
            i;

        for (i = 0; i < sURLVariables.length; i++) {
            sParameterName = sURLVariables[i].split('=');

            if (sParameterName[0] === sParam) {
                return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
            }
        }
        return false;
    };
    $(document).ready(function() {
        // Kitchenware Filters
        $.getJSON("/api/v1.0.0/public/food/get_all_kitchenware", function(data) {
            for (let i = 0; i < data.kitchenware.length; i++) {
                const html = `
                        <span id="sideBarKitchenwareFilter-` + i + `" class="sideBarButton" onclick="toggleKitchenwareFilter($('#sideBarKitchenwareFilter-` + i + `'));">` + data.kitchenware[i].name.replace(/\s/g, '') + `</span>
                    `;
                $("#kitchenwareContainer").append(html);
            }
        });
        // Search page
        if (getUrlParameter("q")) {
            var query = getUrlParameter("q");
            if (getUrlParameter("q").length > 512) {
                $("#search-limit").html("<i>Your search query was limited to 512 characters</i> (Characters after \"" + query.substring(502, 512) + "\" were ignored)");
                query = getUrlParameter("q").substring(0, 512);
            }
            $("#recipe-search").val(query);
            $("#search-term").html(query);
            $.getJSON("/api/v1.0.0/public/recipe/search_recipes?q=" + query, function(data) {
                var recipes = Object.values(data.recipes);
                console.log(recipes[0]);
                recipes.sort(function(a, b) {
                    return a["score"] < b["score"];
                });
                console.log(recipes);
                var html = "";
                for (var i = 0; i < recipes.length; i++) {
                    html += "<div class='col-md-4'><div class='card'><div class='card-body' style='background: linear-gradient(to right, #fcba03, #fc9003);'><h5 class='card-title' style='color: black;'>" + recipes[i].recipe.title + "</h5><p class='card-text' style='color: black;'>" + recipes[i].recipe.subtitle + "</p><a href='/recipe/" + recipes[i].recipe.pk + "' class='btn search-btn'>View Recipe</a><p class='card-text' style='color: black;'>Relevance score: <i>" + recipes[i].score + "</i></p></div></div></div>";
                }
                $("#search-results").html(html);
            });
        }
    });
</script>
{{ render_partial('partials/footer.html') }}