{{ render_partial('partials/header.html') }}
<!--div class="sidebar">
    <div class="sideBarCategory">
        <p>Filter by Type</p>
    </div>
    <a class="sideBarButton" id="typeBtn1" href="#">BBQ</a>
    <a class="sideBarButton" id="typeBtn2" href="#">Pasta</a>
    <a class="sideBarButton" id="typeBtn3" href="#">Roasts</a>
    <a class="sideBarButton" id="typeBtn4" href="#">Seafood</a>
    <a class="sideBarButton" id="typeBtn5" href="#">Vegan</a>
    <a class="sideBarButton" id="typeBtnMore" href="#">More...</a>
    <div class="sidebarBreakLine"></div>
    <div class="sideBarCategory">
        <p>Filter by Kitchenware</p>
    </div>
    <a class="sideBarButton" id="kitchenwareBtn1" href="#">Air Fryer</a>
    <a class="sideBarButton" id="kitchenwareBtn2" href="#">Electric Mixer</a>
    <a class="sideBarButton" id="kitchenwareBtn3" href="#">Food Processor</a>
    <a class="sideBarButton" id="kitchenwareBtn4" href="#">Immersion Blender</a>
    <a class="sideBarButton" id="kitchenwareBtn5" href="#">Wok</a>
    <a class="sideBarButton" id="kitchenwareBtnMore" href="#">More...</a>
    <div class="sidebarBreakLine"></div>
</div-->
<div id="main">
    <div class="container">
        <div class="row justify-content-center">
            <div class="card shadow-sm" style="padding: 2vw; background-color: #262927;">
                <div class="card-header bg-primary" style="background: linear-gradient(to right, #fcba03, #fc9003); color: black">
                    <span id="recipe_title_top"></span>
                </div>
                <div class="card-body" id="recipe-body">
                    <h4 class="card-title text-center" id="recipe_title"></h4>
                    <p class="card-subtitle text-muted text-center mb-2" style="color: white !important;">
                        <span id="recipe_subtitle"></span>
                    </p>
                    <p class="card-subtitle text-muted text-center mb-2" style="color: white !important;">
                        <span id="recipe_description"></span>
                    </p>
                    <hr>
                    <h6 class="card-subtitle text-muted text-center mb-2" style="color: white !important;">
                        Uploaded on: <i><span id="uploaded"></span></i>
                    </h6>
                    <h6 class="card-subtitle text-muted text-center mb-2" style="color: white !important;">
                        Uploaded by: <b><span id="username"></span></b>
                    </h6>
                    <div id="media-container">
                    </div>
                    <p class="card-text">
                        <div id="ingredients"></div>
                    </p>
                    <hr>
                    <p class="card-text">
                        <div id="instructions"></div>
                    </p>
                    <hr>
                    <h4 class="card-title text-center">Comments</h4>
                    <p class="card-text">
                        {% if not current_user.is_anonymous %}
                        <form action="" method="post">
                            {{ form.hidden_tag() }}
                            <div class="py-1 row justify-content-center">
                                <div class="input-group mb-3">
                                    <!--
                                        <textarea class="form-control" id="comment-textarea"
                                        rows="6" placeholder="Write your comment here. . ."
                                        maxlength="1024"
                                        style="resize:none;"></textarea>
                                        -->
                                    {{ form.contents( class="form-control", rows="6", placeholder="Write your comment here. . .", maxlength="1024", style="resize:none; background-color: #262927; color: #fff;" ) }}
                                    <div class="input-group-prepend">
                                        <button type="submit" class="btn btn-black" style="background: linear-gradient(to right, #fcba03, #fc9003);">Post
                                        comment</button>
                                    </div>
                                </div>
                            </div>
                        </form>
                        {% endif %}
                        <div class="py-2 column" id="comments"></div>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
    $(document).ready(function() {
        $.getJSON('/api/v1.0.0/public/recipe/get_single_recipe_details?pk=' + window.location.pathname.split("/").pop(), function(data) {
            if (typeof data.error !== "undefined" && data.error) {
                $('#recipe-body').html('<p>' + data.message + '</p>');
            } else {
                $.each(data.recipe, function(key, val) {
                    switch (key) {
                        case 'title':
                            $('#recipe_title').html(val);
                            $('#recipe_title_top').html(val);
                            $(document).attr('title', $(document).find("title").text() + ' - ' + val);
                            break;
                        case 'subtitle':
                            $('#recipe_subtitle').html(val);
                            break;
                        case 'user':
                            $('#username').html(val.username);
                            break;
                        case 'uploaded':
                            $('#uploaded').html(val);
                            break;
                        case 'ingredients':
                            $.each(val, function(i, ingredient) {
                                const op = ingredient.optional ? " (Optional) " : "";
                                if (ingredient.count > 0)
                                    $('#ingredients').append('<i>' + ingredient.count + ' ' + ingredient.unit + '</i> ' + ingredient.name + op + '<br/>');
                                else
                                    $('#ingredients').append(ingredient.name + op + '<br/>');
                            });
                            break;
                        case 'instructions':
                            $.each(val, function(i, instruction) {
                                $('#instructions').append('&nbsp;&nbsp;&nbsp;<strong>' + instruction.instruction_number + '.</strong> ' + instruction.description + (instruction.optional ? '(Optional)' : '') + '<br/>');
                            });
                            break;
                        case 'comments':
                            $.each(val, function(i, comment) {
                                // Is this comment a reply?
                                if (comment.reply_to != undefined) {
                                    // Build a replies div if it doesn't exist
                                    if ($('#comment-' + comment.reply_to + '-replies').length == 0) {
                                        $('#comment-' + comment.reply_to).append('<div class="border-left border-dark pl-4" id="comment-' + comment.reply_to + '-replies"></div>');
                                    }
                                    $('#comment-' + comment.reply_to + '-replies').append('<div id="comment-' + comment.pk + '"><div id = "comment-' + comment.pk + '-username" style="font-weight: bold;"></div> <small>' + comment.uploaded + '</small><br><div id = "comment-' + comment.pk + '-contents" style="white-space: pre-wrap;"></div><br></div>');
                                }
                                // Is this comment a suggestion?
                                else if (comment.suggestion) {
                                    $('#comments').append('<div id="comment-' + comment.pk + '"><div id = "comment-' + comment.pk + '-username" style="font-weight: bold;"></div> <small>' + comment.uploaded + '</small><br><p class="text-center mb-2 text-muted">SUGGESTION</p><div id = "comment-' + comment.pk + '-contents" style="white-space: pre-wrap;"></div><br></div>');
                                } else {
                                    $('#comments').append('<div id="comment-' + comment.pk + '"><div id = "comment-' + comment.pk + '-username" style="font-weight: bold;"></div> <small>' + comment.uploaded + '</small><br><div id = "comment-' + comment.pk + '-contents" style="white-space: pre-wrap;"></div><br></div>');
                                }
                                // Display our username and comment contents
                                $(document.createTextNode(
                                    comment.user.username
                                )).appendTo('#comment-' + comment.pk + '-username');
                                $(document.createTextNode(
                                    comment.contents.replace(/\n\n\n+/g, '\n\n')
                                    .trim()
                                )).appendTo('#comment-' + comment.pk + '-contents');
                            });
                            break;
                        case 'media':
                            $.each(val, function(i, media) {
                                if (media.is_video) {
                                    $('#media-container').append('<div class="col-sm-7"><iframe style="display: block;border-style:none;" width="420" height="315" src="https://www.youtube.com/embed/' + media.media_link + '"></iframe></div>');
                                } else {
                                    $('#media-container').append('<div class="col-sm-7"><img class="img-fluid" src="' + media.media_link + '"></div>');
                                }
                            });
                            break;
                    }
                });
            }
        });
    });
</script>
{{ render_partial('partials/footer.html') }}